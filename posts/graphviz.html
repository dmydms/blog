<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="content-security-policy" content=""><title>GraphViz로 그래프 그리기 :: 공부왕 김공부</title><link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml" data-svelte="svelte-1bmcg5l"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" data-svelte="svelte-1bmcg5l"><script data-svelte="svelte-1bmcg5l">;(function (w, d, s, l, i) {
      w[l] = w[l] || []
      w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' })
      var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != 'dataLayer' ? '&l=' + l : ''
      j.async = true
      j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl
      f.parentNode.insertBefore(j, f)
    })(window, document, 'script', 'dataLayer', 'GTM-PHD2KSF')
  </script><meta name="description" content="GraphViz WASM을 연결해서 그래프를 그리는 방법" data-svelte="svelte-1etj527">
	<link rel="stylesheet" href="/_app/assets/pages/__layout.svelte-a310949f.css">
	<link rel="stylesheet" href="/_app/assets/LayoutDefault-f057f759.css">
	<link rel="modulepreload" href="/_app/start-45cd698a.js">
	<link rel="modulepreload" href="/_app/chunks/index-40d1c8d0.js">
	<link rel="modulepreload" href="/_app/chunks/preload-helper-e4860ae8.js">
	<link rel="modulepreload" href="/_app/chunks/singletons-d1fb5791.js">
	<link rel="modulepreload" href="/_app/pages/__layout.svelte-7800c35d.js">
	<link rel="modulepreload" href="/_app/chunks/conf-cbd2bb0f.js">
	<link rel="modulepreload" href="/_app/pages/posts/graphviz.md-e8151326.js">
	<link rel="modulepreload" href="/_app/chunks/LayoutDefault-8f32cd80.js">
  </head>
  <body>
    




<nav class="gnb svelte-1y5881k"><ul class="svelte-1y5881k"><li><a sveltekit:prefetch href="/">블로그 홈</a></li>
    <li><a sveltekit:prefetch href="/posts/about">소개</a></li></ul></nav>

<main>

<article class="post"><h1>GraphViz로 그래프 그리기</h1>
  <p class="info svelte-1fq8f0d"><time>2022-04-23</time></p>
  <p>스벨트킷 블로그에 GraphViz로 그래프 그리는 방법을 정리했습니다.</p>
<h2 id="graphviz-소개"><a href="#graphviz-소개">Graphviz 소개</a></h2>
<p><a href="https://graphviz.org/" rel="nofollow">GraphViz</a>는 널리 쓰이는 그래프 렌더링 라이브러리입니다. 특히
<code>dot</code>이라는 언어가 유명한데요, 아래와 같이 dot 언어로 소스를 작성하면 이미지를 만들어 줍니다.</p>
<pre class="language-dot"><!-- HTML_TAG_START --><code class="language-dot"><span class="token keyword">digraph</span> <span class="token graph-name class-name">G</span> <span class="token punctuation">&#123;</span>
  <span class="token attr-name">rankdir</span><span class="token operator">=</span><span class="token attr-value">TD</span><span class="token punctuation">;</span>
  <span class="token node">A</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span><span class="token node">B</span><span class="token punctuation">,</span> <span class="token node">C</span><span class="token punctuation">&#125;</span> <span class="token operator">-></span> <span class="token node">D</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre>
<pre class="language-render-dot"><!-- HTML_TAG_START --><code class="language-render-dot">digraph G &#123;
  A -&gt; &#123;B, C&#125; -&gt; D;
&#125;</code><!-- HTML_TAG_END --></pre>
<h2 id="웹-브라우저에서-graphviz-이용하기"><a href="#웹-브라우저에서-graphviz-이용하기">웹 브라우저에서 GraphViz 이용하기</a></h2>
<p>GraphViz는 C 언어로 만들어져 있어서 브라우저에서 바로 사용할 수 없습니다. 하지만 웹어셈블리로
컴파일한 자바스크립트용 패키지인
<a href="https://www.npmjs.com/package/@hpcc-js/wasm" rel="nofollow">@hpcc-js/wasm</a>이 있으니 그걸 쓰면 쉽게
해결할 수 있습니다.</p>
<p>CDN을 통해 동적 임포트를 사용할 예정이라 별도로 <code>npm install</code>을 하지는 않았습니다.</p>
<h2 id="스벨트킷과-연동하기"><a href="#스벨트킷과-연동하기">스벨트킷과 연동하기</a></h2>
<p>아래와 같이 <code>render-dot</code> 코드 블럭을 만들면 이를 그래프로 바꿔주도록 하면 MDX 형식의 문서
안에서 쉽게 쓸 수 있으니 좋을 것 같아요.</p>
<pre class="language-undefined"><!-- HTML_TAG_START --><code class="language-undefined">&#96;&#96;&#96;render-dot
digraph G &#123;
  A -&gt; &#123;B, C&#125; -&gt; D;
&#125;
&#96;&#96;&#96;</code><!-- HTML_TAG_END --></pre>
<p><code>/src/lib/graphviz.ts</code> 파일을 생성하고 아래 내용을 작성했습니다.</p>
<pre class="language-typescript"><!-- HTML_TAG_START --><code class="language-typescript"><span class="token keyword">const</span> <span class="token constant">DEFAULT_DOT</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">digraph G &#123;&#125;</span><span class="token template-punctuation string">&#96;</span></span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">renderDot</span><span class="token punctuation">(</span>el<span class="token operator">:</span> HTMLElement<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// @ts-ignore: no type definition</span>
  <span class="token keyword">const</span> hpcc <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'https://cdn.jsdelivr.net/npm/@hpcc-js/wasm/dist/index.es6.js'</span><span class="token punctuation">)</span>
  hpcc<span class="token punctuation">.</span><span class="token function">wasmFolder</span><span class="token punctuation">(</span><span class="token string">'https://cdn.jsdelivr.net/npm/@hpcc-js/wasm/dist/'</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> src <span class="token operator">=</span> el<span class="token punctuation">.</span>textContent <span class="token operator">||</span> <span class="token constant">DEFAULT_DOT</span>
  <span class="token keyword">const</span> newEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
  newEl<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'rendered-image'</span><span class="token punctuation">)</span>
  newEl<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">await</span> hpcc<span class="token punctuation">.</span>graphviz<span class="token punctuation">.</span><span class="token function">layout</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token string">'svg'</span><span class="token punctuation">,</span> <span class="token string">'dot'</span><span class="token punctuation">)</span>
  el<span class="token punctuation">.</span>parentNode<span class="token operator">?.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>newEl<span class="token punctuation">,</span> el<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre>
<p><code>/components/LayoutDefault.svelte</code> 파일을 수정하여 위에서 작성한 코드를 연결했습니다.</p>
<pre class="language-svelte"><!-- HTML_TAG_START --><code class="language-svelte"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> renderDot <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'$lib/graphviz'</span>
  <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> onMount <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'svelte'</span>

  <span class="token function">onMount</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> els <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'pre.language-render-dot'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    els<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>renderDot<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><!-- HTML_TAG_END --></pre>
<p>하지만 이렇게 하면 렌더링된 그래프의 배경색이 이 블로그와 어울리지 않습니다. 배경색을 어둡게
바꾸고, 그래프 기본 전경색을 밝은 계열로 지정하도록 몇 가지 수정을 했습니다.</p>
<p>우선, <code>graphviz.ts</code>를 수정하여 모든 그래프의 기본 옵션에 해당하는 내용을 변수로 만듭니다.</p>
<pre class="language-typescript"><!-- HTML_TAG_START --><code class="language-typescript"><span class="token keyword">const</span> <span class="token constant">GLOBAL_OVERRIDE</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">
  bgcolor="transparent";
  node [color="#DDDDDD"; fontcolor="#DDDDDD"];
  edge [color="#DDDDDD"; fontcolor="#DDDDDD"];
</span><span class="token template-punctuation string">&#96;</span></span></code><!-- HTML_TAG_END --></pre>
<p>같은 파일에서, 정규식을 이용하여 위 내용을 원래의 <code>dot</code> 소스 코드에 주입하도록 수정합니다.</p>
<pre class="language-typescript"><!-- HTML_TAG_START --><code class="language-typescript"><span class="token comment">// 기존 코드</span>
<span class="token keyword">const</span> src <span class="token operator">=</span> el<span class="token punctuation">.</span>textContent <span class="token operator">||</span> <span class="token constant">DEFAULT_DOT</span>

<span class="token comment">// 바뀐 코드</span>
<span class="token keyword">const</span> src <span class="token operator">=</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>textContent <span class="token operator">||</span> <span class="token constant">DEFAULT_DOT</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(.+?&#123;)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">s</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">$1 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">GLOBAL_OVERRIDE</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span></code><!-- HTML_TAG_END --></pre>
<p>마지막으로, CSS를 수정하여 컴포넌트의 배경색을 어두운 색으로 바꿨습니다.</p>
<pre class="language-css"><!-- HTML_TAG_START --><code class="language-css"><span class="token selector">.rendered-image</span> <span class="token punctuation">&#123;</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 1.2rem 1.1rem<span class="token punctuation">;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #1e1e1e<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre>
<h2 id="소스코드"><a href="#소스코드">소스코드</a></h2>
<ul><li>블로그 전체 <a href="https://github.com/gongbughim/blog" rel="nofollow">소스코드</a></li></ul>
<h2 id="관련-글"><a href="#관련-글">관련 글</a></h2>
<ul><li><a href="/posts/sveltekit-blog" sveltekit:prefetch="sveltekit:prefetch">스벨트킷으로 블로그 만들기</a></li></ul>
</article></main>

<footer class="svelte-1y5881k">Copyright ©2022,
  <a href="https://twitter.com/gongbughim" class="external">Twitter</a> |
  <a href="https://github.com/gongbughim" class="external">Github</a>
</footer>


		<script type="module" data-hydrate="s2l8o9">
		import { start } from "/_app/start-45cd698a.js";
		start({
			target: document.querySelector('[data-hydrate="s2l8o9"]').parentNode,
			paths: {"base":"","assets":""},
			session: {},
			route: true,
			spa: false,
			trailing_slash: "ignore",
			hydrate: {
				status: 200,
				error: null,
				nodes: [
					import("/_app/pages/__layout.svelte-7800c35d.js"),
						import("/_app/pages/posts/graphviz.md-e8151326.js")
				],
				params: {},
				routeId: "posts/graphviz"
			}
		});
	</script>
  </body>
</html>
